<!DOCTYPE html>
<html lang="zh-CN">

<!-- 
头部模块：包含页面元数据、标题、图标、外部脚本和样式链接。
- 可修改项：
  - 标题：<title>标签内的文本，可更改页面标题。
  - 图标：link rel="icon" 的 href，可替换为其他图标数据或URL。
  - 脚本：script src，可更新jsPDF库版本或路径（注意兼容性）。
  - 样式：link rel="stylesheet" 的 href，可调整CSS文件路径或添加新样式表。
  - 字符集和视口：meta标签，确保UTF-8和响应式设计，无需修改除非特殊需求。
-->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>手机截图批量打印 - 高效排版工具</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text x=%2250%22 y=%22.9em%22 font-size=%2285%22 text-anchor=%22middle%22>🖼️</text></svg>">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="/index.css">
</head>

<!-- 
主体模块：页面主要内容容器，使用id="theBody" class="mode-9"定义默认布局模式。
- 可修改项：
  - class="mode-9"：可更改为其他模式类（如mode-6或mode-12），影响布局样式（需对应CSS调整）。
  - id="theBody"：用于JS引用，可保持不变。
  - 整体背景/颜色：在CSS中调整body选择器，如背景色、字体大小等。
-->

<body id="theBody" class="mode-9">

    <!-- 
    浏览器警告模块：显示浏览器兼容性警告，支持关闭按钮。
    - 功能：当浏览器不支持某些功能时显示提示。
    - 可修改项：
      - 内容文本：div内的文本，可更改警告消息。
      - 样式类：class="browser-warning" 和 "browser-warning-content"，在CSS中调整颜色（如背景色）、间距（padding/margin）、字体大小。
      - 关闭按钮：onclick="closeBrowserWarning()"，确保JS函数存在；按钮样式class="browser-warning-close"，可改大小、颜色。
    -->

    <div class="browser-warning" id="browserWarning">
        <div class="browser-warning-content">
            <div>⚠️ 您的浏览器可能不完全支持所有功能，建议使用 Chrome、Edge 或 Firefox 最新版本</div>
            <button class="browser-warning-close" onclick="closeBrowserWarning()">×</button>
        </div>
    </div>
    
    <!-- 
    打印对话框模块：打印设置提示弹窗，包括布局信息和按钮。
    - 功能：打印前确认设置，如纸张方向、大小、边距。
    - 可修改项：
      - 标题和文本：h3和p标签内容，可更改提示文字。
      - 动态元素：id="printModeText"、"printOrientationText"，由JS填充，可在CSS调整字体粗细、颜色。
      - 按钮：class="print-dialog-btn print-dialog-confirm/cancel"，在CSS中改颜色、间距、大小；onclick事件确保JS函数匹配。
      - 整体样式：class="print-dialog" 和 "print-dialog-content"，调整弹窗位置、背景色、阴影等。
    -->

    <div class="print-dialog" id="printDialog">
        <div class="print-dialog-content">
            <h3>🖨️ 打印设置提示</h3>
            <p>当前布局模式：<strong id="printModeText">1页9张(纵向)</strong></p>
            <p>请在稍后的打印设置中确认以下事项：</p>
            <p>1. <strong>纸张方向</strong>：设置为 <strong id="printOrientationText">纵向</strong></p>
            <p>2. <strong>纸张大小</strong>：设置为 <strong>A4</strong></p>
            <p>3. <strong>页边距</strong>：设置为 <strong>无</strong> 或 <strong>最小</strong></p>
            <p>4. <strong>缩放比例</strong>：设置为 <strong>100%</strong> 或 <strong>默认</strong></p>
            <p class="print-tip">💡 提示：裁剪线已开启，打印后可按虚线裁剪</p>
            <div class="print-dialog-buttons">
                <button class="print-dialog-btn print-dialog-confirm" id="confirmPrint">确认设置并打印</button>
                <button class="print-dialog-btn print-dialog-cancel" id="cancelPrint">取消打印</button>
            </div>
        </div>
    </div>
    
    <!-- 
    帮助对话框模块：使用说明弹窗，包含多个部分的内容。
    - 功能：提供工具简介、操作步骤、技巧等，带关闭按钮。
    - 可修改项：
      - 内容结构：h2、h3、p标签，可添加/修改文本、链接。
      - 链接：a href，如"https://ly.topmer.top"，可更改目标URL。
      - 样式类：class="help-dialog"、"help-dialog-content"、"help-section"等，在CSS中调整间距（gap/padding）、颜色、字体大小。
      - 关闭按钮：onclick="closeHelp()"，确保JS函数；class="help-close"，改大小/颜色。
    -->

    <div class="help-dialog" id="helpDialog">
        <div class="help-dialog-content">
            <button class="help-close" onclick="closeHelp()">×</button>
            <h2>📚 使用说明</h2>
            
            <div class="help-section">
                <h3>📋 工具简介</h3>
                <p>手机截图批量打印是一个专为高效打印竖版手机截图设计的在线工具，支持将多张手机截图智能排版到A4纸上，实现规范、经济的批量打印。</p>
            </div>
            
            <div class="help-section">
                <h3>🚀 快速开始</h3>
                <p><strong>1. 加载手机截图文件</strong>：将手机截图拖入虚线区域或点击"点击加载"按钮</p>
                <p><strong>2. 选择打印布局</strong>：1页6张(纵向)、1页9张(纵向)或1页12张(横向)布局</p>
                <p><strong>3. 调整裁剪线</strong>：根据需要开启或关闭裁剪线</p>
                <p><strong>4. 预览与调整</strong>：查看排版效果，确认无误</p>
                <p><strong>5. 导出与打印</strong>：导出PDF或直接打印</p>
            </div>
            
            <div class="help-section">
                <h3>🧩 布局选择</h3>
                <p><strong>1页6张(纵向)</strong>：A4纸纵向排版，3列×2行，适合标准打印</p>
                <p><strong>1页9张(纵向)</strong>：A4纸纵向排版，3列×3行，默认推荐，平衡清晰度与效率</p>
                <p><strong>1页12张(横向)</strong>：A4纸横向排版，6列×2行，最经济高效</p>
                <p>💡 <strong>9张模式特点</strong>：保留图片宽度，保持原始比例，顶部对齐，底部无用信息自动裁剪</p>
            </div>
            
            <div class="help-section">
                <h3>✂️ 裁剪线功能</h3>
                <p><strong>作用</strong>：在手机截图间隔中添加参考虚线，帮助打印后精确裁剪</p>
                <p><strong>显示</strong>：预览时显示橙色虚线，打印时显示浅灰色虚线</p>
                <p><strong>位置</strong>：在手机截图间隔正中间（4.3mm间距中间）</p>
            </div>
            
            <div class="help-section">
                <h3>⚙️ 打印设置</h3>
                <p><strong>智能方向检测</strong>：根据布局自动设置打印方向</p>
                <p><strong>固定边距</strong>：页边距和手机截图间距均为4.3mm，确保打印精度</p>
            </div>
            
            <div class="help-section">
                <h3>💾 导出与打印</h3>
                <p><strong>导出 PDF</strong>：将所有手机截图合并成一个PDF文件保存</p>
                <p><strong>立即打印</strong>：直接调用浏览器打印功能</p>
            </div>
            
            <div class="help-section">
                <h3>🎯 使用技巧</h3>
                <p><strong>最佳实践</strong>：确保手机截图为竖版3:4比例，效果最佳</p>
                <p><strong>文件列表</strong>：可显示已加载的所有文件名，支持删除单个文件</p>
            </div>
            
            <div class="help-tip">
                <strong>💡 温馨提示：</strong> 打印前请确保打印机已连接。建议先导出一页进行测试打印。
            </div>
            
            <div class="help-section">
                <h3>⚠️ 重要提示</h3>
                <p><strong>格式支持</strong>：支持JPG、PNG、WEBP等常见图片格式</p>
                <p><strong>文件限制</strong>：单次最多处理50个文件，单个文件建议不超过3MB</p>
            </div>
            
            <div class="help-section">
                <h3>📞 支持与反馈</h3>
                <p>如有问题或建议，请💬<a href="https://ly.topmer.top" target="_blank" rel="noopener noreferrer">给我留言</a>😉</p>
            </div>
            
            <div class="help-section">
                <h3>📄 免责声明</h3>
                <p>1. 本工具仅处理图片文件，不存储用户数据。2. 打印效果受设备影响。</p>
            </div>
        </div>
    </div>

    <!-- 
    主卡片模块：页面核心内容容器，包括头部、上传区、设置面板、工具栏和预览网格。
    - 功能：整合所有交互元素。
    - 可修改项：
      - 整体样式：class="main-card"，在CSS中调整宽度、边框、背景色、间距（padding/margin）。
    -->

    <div class="main-card">
        
        <!-- 
        头部子模块：标题和功能按钮。
        - 功能：显示标题，提供导航按钮。
        - 可修改项：
          - 标题：h1标签文本，可更改工具名称。
          - 按钮：class="header-btn" 子类如home-btn、invoice-btn、help-btn，在CSS调整大小、颜色、间距；onclick事件确保JS函数（如goToHomePage()）。
          - title属性：鼠标悬停提示，可修改文本。
        -->

        <div class="header">
            <h1>手机截图批量排版打印</h1>
            <button class="header-btn home-btn" onclick="goToHomePage()" title="更多工具">🏠</button>
            <button class="header-btn invoice-btn" onclick="openInvoiceTool()" title="发票打印">🧾</button>
            <button class="header-btn help-btn" onclick="showHelp()" title="使用说明">❓</button>
        </div>

        <!-- 
        顶部布局子模块：包含文件拖拽区和设置面板。
        - 功能：文件上传和布局配置。
        - 可修改项：
          - 样式：class="top-layout"，在CSS调整flex布局、间距。
        -->

        <div class="top-layout">
            
            <!-- 
            文件上传容器子模块：拖拽区、反馈区、进度条。
            - 功能：处理文件上传、显示列表和进度。
            - 可修改项：
              - 拖拽区：id="dropZone" class="drop-zone"，在CSS调整边框颜色（虚线）、图标大小、文本颜色、间距。
              - 输入：input type="file" accept，可添加更多图片格式。
              - 反馈区：id="feedbackArea"，class="drop-zone"，调整成功消息颜色、文件列表高度。
              - 文件列表：id="fileList"，在CSS改滚动条样式、项间距。
              - 进度条：id="progressWrapper"，class="progress-wrapper"，调整颜色、宽度、高度。
            -->

            <div class="drop-zone-container">
                <div id="dropZone" class="drop-zone" onclick="document.getElementById('fileIn').click()">
                    <div class="upload-icon">📤</div>
                    <div class="upload-text">将手机截图拖入此处</div>
                    <div class="upload-subtext">或 <span>点击加载</span> (支持多选)</div>
                    <div class="upload-limit">✨ 仅适用于手机截图，每次不超过50张 ✨</div>
                    <input type="file" id="fileIn" accept="image/jpeg,image/png,image/jpg,image/webp" multiple style="display:none;">
                </div>
                
                <div id="feedbackArea" class="drop-zone">
                    <div id="successInfo" class="success-msg"></div>
                    
                    <div class="file-list-container">
                        <div class="file-list-header">
                            <span>📄 已加载文件 (<span id="fileCount">0</span>)</span>
                            <button class="continue-add-btn" onclick="continueAddFiles()">+ 继续添加</button>
                        </div>
                        <div class="file-list-scroll">
                            <div class="file-list" id="fileList"></div>
                        </div>
                    </div>
                    
                    <div class="reset-hint">💡 如需要处理新的文件，请点击 "清空重置" 开始一个新任务。</div>
                </div>
                
                <div class="progress-wrapper" id="progressWrapper">
                    <div class="progress-bar" id="progressBar"></div>
                    <div class="progress-text" id="progressText">0 / 0</div>
                </div>
            </div>

            <!-- 
            设置面板子模块：裁剪线开关和布局选择按钮。
            - 功能：配置打印选项。
            - 可修改项：
              - 单元样式：class="setting-unit" 和 "unit-full"，调整间距、背景。
              - 开关按钮：id="cutLineToggle" class="toggle-btn btn-on"，在CSS改颜色（开启/关闭状态）、大小。
              - 布局按钮：id="m6/m9/m12" class="btn-mode"，active类表示选中，在CSS调整颜色、间距、字体。
              - 按钮组：style="flex-direction: column; gap: 10px;"，可改gap值为调整按钮间距。
            -->

            <div class="settings-panel">
                <div class="setting-unit">
                    <div class="unit-header">✂️ 裁剪线</div>
                    <button id="cutLineToggle" class="toggle-btn btn-on" onclick="toggleCutLines()">已开启</button>
                </div>
                
                <div class="setting-unit unit-full">
                    <div class="unit-header">🧩 布局选择</div>
                    <div class="mode-group" style="flex-direction: column; gap: 10px;">
                        <button id="m6" class="btn-mode" onclick="setMode(6)">1页6张(纵向)</button>
                        <button id="m9" class="btn-mode active" onclick="setMode(9)">1页9张(纵向)</button>
                        <button id="m12" class="btn-mode" onclick="setMode(12)">1页12张(横向)</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 
        工具栏子模块：导出、打印和重置按钮。
        - 功能：触发PDF导出、打印和应用重置。
        - 可修改项：
          - 按钮：class="btn-large btn-pdf/print/reset"，在CSS调整颜色、大小、间距；disabled属性由JS控制。
          - onclick事件：确保JS函数如savePDF()存在。
        -->

        <div class="toolbar">
            <button id="exportBtn" class="btn-large btn-pdf" disabled onclick="savePDF()">💾 导出 PDF</button>
            <button id="printBtn" class="btn-large btn-print" disabled onclick="showPrintDialog()">🖨️ 立即打印</button>
            <button class="btn-large btn-reset" onclick="resetApp()">🧹 清空重置</button>
        </div>
        
        <!-- 
        预览网格子模块：显示排版预览。
        - 功能：渲染上传图片的布局预览。
        - 可修改项：
          - id="previewGrid"：用于JS动态填充，在CSS调整网格布局、间距、边框。
        -->

        <div id="previewGrid"></div>
    </div>

    <!-- 
    页脚模块：版权信息和链接。
    - 功能：显示版权和反馈链接。
    - 可修改项：
      - 文本：Copyright © 2026，可更新年份。
      - 链接：a href，可更改URL。
      - 样式：class="footer"，在CSS调整位置、颜色、字体大小、间距。
    -->

    <div class="footer">
        Copyright © 2026 <a href="https://topmer.top/" target="_blank">Topmer</a>
        | v2.3.0 | 💬<a href="https://ly.topmer.top" target="_blank" rel="noopener noreferrer">给我留言</a>
    </div>
    
    <!-- 
    脚本加载模块：引入外部JS文件。
    - 功能：加载核心脚本和模块。
    - 可修改项：
      - src路径：可更新文件路径或版本。
      - type="module"：用于ES模块，确保浏览器支持。
    -->

    <script src="script.js"></script>
    
    <script type="module" src="/index.tsx"></script>
</body>
</html>